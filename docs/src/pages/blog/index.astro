---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { Card, CardGrid, Aside, Badge } from '@astrojs/starlight/components';
import { getCollection } from 'astro:content';

// Get all blog posts
const allPosts = await getCollection('docs', (entry) => 
  entry.id && entry.id.startsWith('blog/day-')
);

// Group posts by day
const postsByDay = new Map();

allPosts.forEach(post => {
  const dayMatch = post.id.match(/day-(\d+)/);
  if (dayMatch) {
    const day = parseInt(dayMatch[1]);
    if (!postsByDay.has(day)) {
      postsByDay.set(day, { human: null, claude: null });
    }
    
    if (post.data.authors?.includes('human')) {
      postsByDay.get(day).human = post;
    } else if (post.data.authors?.includes('claude')) {
      postsByDay.get(day).claude = post;
    }
  }
});

// Sort days in descending order
const sortedDays = Array.from(postsByDay.keys()).sort((a, b) => b - a);
---

<StarlightPage frontmatter={{ 
  title: "Development Blog", 
  description: "Two perspectives on building a database - human curiosity meets AI implementation" 
}}>
  
  <Aside type="tip">
    üß† <strong>Two Minds, One Database</strong> - Follow our unique collaboration as a CRUD developer and Claude AI build a database from scratch.
  </Aside>

  <h2>Choose Your Reading Experience</h2>

  <CardGrid>
    <Card title="üë®‚Äçüíª Human Perspective" icon="user">
      Real learning journey through code review and questioning - watch confusion become clarity through iterative collaboration.
    </Card>
    
    <Card title="ü§ñ AI Perspective" icon="rocket">
      Pattern recognition and collaboration analysis - insights on effective teaching and learning patterns.
    </Card>
    
    <Card title="ü§ù Side-by-Side Comparison" icon="puzzle">
      See both perspectives simultaneously - compare human questions with AI insights on the same topics.
    </Card>
  </CardGrid>

  <h2>Development Timeline</h2>

  {sortedDays.length === 0 && (
    <Aside type="note">
      No blog posts found. This might be a data loading issue.
    </Aside>
  )}

  {sortedDays.map(day => {
    const posts = postsByDay.get(day);
    const humanPost = posts?.human;
    const claudePost = posts?.claude;
    
    return (
      <div>
        <div style="margin: 2rem 0 1rem 0;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; color: var(--sl-color-accent);">Day {day}</h3>
            {humanPost && claudePost && (
              <span style="font-size: 0.9rem; color: var(--sl-color-text-accent);">
                üìä <a href={`/blog/day-${day}/both/`}>Compare both views</a>
              </span>
            )}
          </div>
        </div>
        
        <CardGrid>
          {humanPost && (
            <Card 
              title={`üë®‚Äçüíª Human: Day ${day}`}
              icon="user"
            >
              <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">{humanPost.data.title}</h4>
              <p>{humanPost.data.excerpt || humanPost.data.description || 'Human perspective on our database building journey.'}</p>
              
              {humanPost.data.insights && (
                <div style="margin: 0.5rem 0;">
                  {humanPost.data.insights.questionsAsked && (
                    <Badge text={`‚ùì ${humanPost.data.insights.questionsAsked} questions`} variant="note" />
                  )}
                  {humanPost.data.insights.iterations && (
                    <span style="margin-left: 0.5rem;">
                      <Badge text={`üîÑ ${humanPost.data.insights.iterations} iterations`} variant="note" />
                    </span>
                  )}
                </div>
              )}
              
              <p>
                <a href={`/blog/${humanPost.id.replace('blog/', '')}/`}>Read Human Perspective ‚Üí</a>
              </p>
            </Card>
          )}
          
          {claudePost && (
            <Card 
              title={`ü§ñ Claude: Day ${day}`}
              icon="rocket"
            >
              <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">{claudePost.data.title}</h4>
              <p>{claudePost.data.excerpt || claudePost.data.description || 'AI perspective on our database building journey.'}</p>
              
              {claudePost.data.insights && (
                <div style="margin: 0.5rem 0;">
                  {claudePost.data.insights.filesModified && (
                    <Badge text={`üìÅ ${claudePost.data.insights.filesModified} files`} variant="note" />
                  )}
                  {claudePost.data.insights.patternsObserved && (
                    <span style="margin-left: 0.5rem;">
                      <Badge text={`üîç ${claudePost.data.insights.patternsObserved.length} patterns`} variant="note" />
                    </span>
                  )}
                </div>
              )}
              
              <p>
                <a href={`/blog/${claudePost.id.replace('blog/', '')}/`}>Read AI Perspective ‚Üí</a>
              </p>
            </Card>
          )}
        </CardGrid>
        
        {!humanPost && claudePost && (
          <Aside type="note">
            üë®‚Äçüíª Human perspective for Day {day} coming soon...
          </Aside>
        )}
        
        {humanPost && !claudePost && (
          <Aside type="note">
            ü§ñ Claude perspective for Day {day} coming soon...
          </Aside>
        )}
        
        <hr style="margin: 2rem 0; border: 1px solid var(--sl-color-hairline);" />
      </div>
    );
  })}

  <h2>Join Our Journey</h2>

  <Aside type="tip" title="Living Experiment">
    This is real-time documentation of human-AI collaboration in systems programming. Every mistake, every breakthrough, documented as it happens.
  </Aside>

  <CardGrid>
    <Card title="üìö Learn with Tutorials" icon="document">
      Build your own database components step-by-step alongside our journey.
      
      <p><a href="/tutorials/01-key-value-store/">Start Tutorial 1 ‚Üí</a></p>
    </Card>
    
    <Card title="üîß Explore the Code" icon="setting">
      See our actual implementation - every line has a purpose, every decision documented.
      
      <p><a href="/reference/current-implementation/">Current Implementation ‚Üí</a></p>
    </Card>
    
    <Card title="üåü Follow on GitHub" icon="github">
      Star our repository to track progress and join the open source learning experiment.
      
      <p><a href="https://github.com/ferrisdb/ferrisdb">GitHub Repository ‚Üí</a></p>
    </Card>
  </CardGrid>

</StarlightPage>